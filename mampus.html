<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ID</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .login-container { max-width: 400px; margin: 0 auto; padding: 20px; border: 1px solid #ddd; }
        .login-container input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; }
        .login-container button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        .login-container button:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="login-container">
        <img src="assets/nm.png" width="125" height="50">
        <h1>Login</h1>
        <h3>mau beli id?, chat no owner<br>087880306228(owner)</h3>
        <input type="text" id="id" placeholder="Masukin ID Disini" required>
        <input type="password" id="pw" placeholder="Masukin PW Disini" required>
        <button onclick="login()">Login</button>
    </div>

    <script>
        const validUsers = [
            { id: '0', pw: 'owner' },
            { id: '1', pw: 'adm' },
            { id: '2', pw: 'mem' },
            { id: '3', pw: 'akucantik' },
            { id: '4', pw: 'nopal' },
            { id: 'follow', pw: 'vzproject' },
            { id: 'vzproject', pw: '72' },
            { id: '7', pw: '1357' },
        ];

        function isBlacklisted() {
            const blacklistData = JSON.parse(localStorage.getItem('blacklist')) || {};
            const today = new Date().toISOString().slice(0, 10);
            return blacklistData.expiry && new Date(blacklistData.expiry) >= new Date(today);
        }

        function login() {
            if (isBlacklisted()) {
                alert("Anda masih diblacklist!");
                return;
            }

            const id = document.getElementById('id').value;
            const pw = document.getElementById('pw').value;
            const user = validUsers.find(user => user.id === id && user.pw === pw);

            let attempts = parseInt(localStorage.getItem('login_attempts')) || 0;

            if (user) {
                const loginData = { id: user.id, loginTime: Date.now() };
                localStorage.setItem('user_data', JSON.stringify(loginData));
                localStorage.removeItem('login_attempts');
                window.location.href = 'index.html';
            } else {
                attempts++;
                localStorage.setItem('login_attempts', attempts);

                if (attempts >= 2) {
                    const expiryDate = new Date();
                    expiryDate.setDate(expiryDate.getDate() + 30);
                    localStorage.setItem('blacklist', JSON.stringify({ expiry: expiryDate.toISOString().slice(0, 10) }));
                    alert(`Anda telah diblacklist hingga ${expiryDate.toISOString().slice(0, 10)}.`);
                } else {
                    alert('ID atau Password salah! Percobaan: ' + attempts);
                }
            }
        }

        function checkURLForBlacklistRemoval() {
            const urlParams = new URLSearchParams(window.location.search);
            const unblockDate = urlParams.get('bukablacklist');
            const today = new Date().toISOString().slice(0, 10);

            if (unblockDate) {
                if (unblockDate === today) {
                    localStorage.removeItem('blacklist');
                    alert('Anda sudah di whitelist! Blacklist terhapus.');
                    window.location.href = 'index.html';
                } else {
                    alert('Tanggal salah! Anda akan diblacklist permanen.');
                }
            }
        }

        function checkAutoLogin() {
            const userData = JSON.parse(localStorage.getItem('user_data'));

            if (userData) {
                const now = Date.now();
                const loginTime = userData.loginTime || 0;
                const oneHour = 60 * 60 * 1000;

                if (now - loginTime < oneHour) {
                    if (window.location.pathname.includes('login.html')) {
                        window.location.href = 'index.html';
                    }
                } else {
                    localStorage.removeItem('user_data');
                }
            }
        }

        // Hanya jalankan cek login kalau bukan di index.html, biar tidak loop
        if (!window.location.pathname.includes('index.html')) {
            checkAutoLogin();
        }
        checkURLForBlacklistRemoval();
    </script>
</body>
</html>
